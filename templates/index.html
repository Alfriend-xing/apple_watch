<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"> </script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link rel="stylesheet" type="text/css" href={{url_for("static",filename="css/snackbar.css")}}>
    <title>Document</title>
</head>
<body>
    <div class="ui attached stackable menu"
            style="margin:0 0 1.5em;" >
            <div class="ui container">
                <a class="item">
                <i class="home icon"></i> Home
                </a>
                <a class="item">
                <i class="grid layout icon"></i> Browse
                </a>
                <a class="item">
                <i class="mail icon"></i> Messages
                </a>
                <div class="ui simple dropdown item">
                More
                <i class="dropdown icon"></i>
                <div class="menu">
                    <a class="item"><i class="edit icon"></i> Edit Profile</a>
                    <a class="item"><i class="globe icon"></i> Choose Language</a>
                    <a class="item"><i class="settings icon"></i> Account Settings</a>
                </div>
                </div>
                <div class="right item">
                <div class="ui input"><input type="text" placeholder="Search..."></div>
                </div>
                <div class="ui toggle checkbox">
                    <input type="checkbox" tabindex="0" class="hidden">
                    <label>只显示在线主机</label>
                </div>
            </div>
            </div>
    <div class="ui link cards" id="cards">
            <!-- <div class="card" id='ccc'>
                    <div class="content">
                        <div data-tooltip="centos" data-position="top right" id="platform">
                      <img class="right floated mini ui image" 
                      src={{url_for('static',filename='images/centos.png')}}>
                        </div>
                      <div class="header" id="ip">
                          192.168.2.100
                          <a data-tooltip="online" id="state">
                          <i class="mini green circle icon" id="state_icon"></i>
                          </a>
                      </div>
                      <div class="meta">
                          <a class="ui teal label">dev</a>
                      </div>
                      <div class="description">
                          a place to development
                      </div>
                    </div>
                    <div class="extra content">
                            <div class="label">cpu</div>
                            <div class="ui teal progress" 
                            style="margin:0 0 0 0;" 
                            data-tooltip="100/500GB" 
                            data-position="top left" 
                            data-percent="30" 
                            id="p1">
                            <div class="bar"></div>
                            </div>
                            <div class="label">mem</div>
                            <div class="ui progress" 
                            style="margin:0 0 0 0;" 
                            data-tooltip="3.8/4GB" 
                            data-position="top left" 
                            data-percent="30"
                            id="p2">
                            <div class="bar"></div>
                            </div>
                    </div>
            </div> -->
    </div>

    <script>
    $(function(){
// 开始写 jQuery 代码...
function update_form(jsondata){
    console.log('update_form')
    var timestampms=new Date().getTime()
    var timestamp=Math.ceil(timestampms/1000)
    for (data in jsondata) {
        var id=jsondata[data]['id']
        var platform=jsondata[data]['platform']
        var ip=jsondata[data]['ip']
        var cpu=jsondata[data]['cpu']
        var mem=JSON.parse(jsondata[data]["mem"])
        var updatetime=jsondata[data]['updatetime']
        var card=$('#'+id)
        console.log(jsondata[data])
        if (card.length > 0) {
            console.log('timestamp'+timestamp)
            console.log('updatetime'+updatetime)
            if (timestamp-updatetime>5) {
                if (card.find("#state_icon").attr("class")!="mini grey circle icon") {
                    myFunction(ip+"下线")
                    card.find("#state_icon").attr("class","mini grey circle icon")
                }
                else {

                }
            }
            else {
                if (card.find("#state_icon").attr("class")!="mini green circle icon") {
                    myFunction(ip+"上线")
                    card.find("#state_icon").attr("class","mini green circle icon")
                }
                else {
                    
                }
                
            }
            var b = card.find(".bar")
            b.first().attr("style","transition-duration: 2000ms; width:"+jsondata[data]["cpu"]+"%")
            b.last().attr("style","transition-duration: 2000ms; width:"+JSON.parse(jsondata[data]["mem"])["percent"]+"%")
        }
        else {
            console.log('add card')
            var t='<div class="card" id="'+id+'">\
                    <div class="content">\
                        <div data-tooltip="'+platform+'" data-position="top right" id="platform">\
                      <img class="right floated mini ui image" \
                      src={{url_for("static",filename="images/centos.png")}}>\
                        </div>\
                      <div class="header" id="ip">\
                          '+ip+'\
                          <a data-tooltip="online" id="state">\
                          <i class="mini green circle icon" id="state_icon"></i>\
                          </a>\
                      </div>\
                      <div class="meta">\
                          <a class="ui teal label">dev</a>\
                      </div>\
                      <div class="description">\
                          a place to development\
                      </div>\
                    </div>\
                    <div class="extra content">\
                            <div class="label">cpu</div>\
                            <div class="ui teal progress" \
                            style="margin:0 0 0 0;" \
                            data-position="top left" \
                            id="p1">\
                            <div class="bar" \
                            style="transition-duration: 2000ms; width: '+cpu+'%;"></div>\
                            </div>\
                            <div class="label">mem</div>\
                            <div class="ui progress" \
                            style="margin:0 0 0 0;" \
                            data-tooltip="'+mem["used"]+'/'+mem["total"]+'" \
                            data-position="bottom left" \
                            id="p2">\
                            <div class="bar"  \
                            style="transition-duration: 2000ms; width: '+mem["percent"]+'%;"></div>\
                            </div>\
                    </div>\
            </div>'
            $("#cards").append(t)
        }
    }
}
function refun() {
    $.getJSON( "api", function( data ) {
        update_form(data);
        });
    // update_form([{'id':'ccc',
    // 'cpu':Math.ceil(Math.random()*100),
    // 'mem':Math.ceil(Math.random()*100)}]);
}
window.setInterval( refun, 1000);
// $("#ccc").find('#p1').progress();
// $("#ccc").find('#p2').progress();
$("#ccc").find("#p2").find(".bar").attr("style","transition-duration: 3000ms; width: 37%;");
});
    </script>
    <button onclick="myFunction(new Date().getTime())">Show Snackbar</button>

    <div id="snackbars">Some text some message..</div>
    
    <script>
    function myFunction(msg) {
      var x = $("#snackbars");
      var sb = $("<div></div>")
      sb.attr({"id":"snackbar",
                "class":"show"})
    sb.text(msg)
    x.append(sb)
    //   x.className = "show";
      setTimeout(function(){ sb.remove(); }, 3000);
    }
    </script>
</body>
</html>