<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"> </script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link rel="stylesheet" type="text/css" href={{url_for("static",filename="css/snackbar.css")}}>
    <title>Document</title>
</head>
<body>
    <div class="ui attached stackable menu"
            style="margin:0 0 1.5em;" >
            <div class="ui container">
                <a class="item">
                <img src={{url_for("static",filename="images/banana.jpg")}}> Banana
                </a>
                <a class="item" href="https://github.com/Alfriend-xing/banana">
                <i class="github icon"></i> Home
                </a>
                <!-- <a class="item">
                <i class="grid layout icon"></i> Browse
                </a>
                <a class="item">
                <i class="mail icon"></i> Messages
                </a>
                <div class="ui simple dropdown item">
                More
                <i class="dropdown icon"></i>
                <div class="menu">
                    <a class="item"><i class="edit icon"></i> Edit Profile</a>
                    <a class="item"><i class="globe icon"></i> Choose Language</a>
                    <a class="item"><i class="settings icon"></i> Account Settings</a>
                </div>
                </div> -->
            </div>
            </div>
    <div class="ui link cards" id="cards">
            <!-- <div class="card" id='ccc'>
                    <div class="content">
                        <div data-tooltip="centos" data-position="top right" id="platform">
                      <img class="right floated mini ui image" 
                      src={{url_for('static',filename='images/centos.png')}}>
                        </div>
                      <div class="header" id="ip">
                          192.168.2.100
                          <a data-tooltip="online" id="state">
                          <i class="mini green circle icon" id="state_icon"></i>
                          </a>
                      </div>
                      <div class="meta">
                          <a class="ui teal label">dev</a>
                      </div>
                      <div class="description">
                          a place to development
                      </div>
                    </div>
                    <div class="extra content">
                            <div class="label">cpu</div>
                            <div class="ui teal progress" 
                            style="margin:0 0 0 0;" 
                            data-tooltip="100/500GB" 
                            data-position="top left" 
                            data-percent="30" 
                            id="p1">
                            <div class="bar"></div>
                            </div>
                            <div class="label">mem</div>
                            <div class="ui progress" 
                            style="margin:0 0 0 0;" 
                            data-tooltip="3.8/4GB" 
                            data-position="top left" 
                            data-percent="30"
                            id="p2">
                            <div class="bar"></div>
                            </div>
                    </div>
            </div> -->
    </div>

    <script>
    $(function(){
// 开始写 jQuery 代码...
function update_form(jsondata){
    // console.log('update_form')
    var timestampms=new Date().getTime()
    var timestamp=Math.ceil(timestampms/1000)
    for (data in jsondata) {
        var id=jsondata[data]['id']
        var platform=jsondata[data]['platform']
        var ip=jsondata[data]['ip']
        var cpu=jsondata[data]['cpu']
        var mem=JSON.parse(jsondata[data]["mem"])
        var updatetime=jsondata[data]['updatetime']
        var card=$('#'+id)
        // console.log(jsondata[data])
        if (card.length > 0) {
            // console.log('timestamp'+timestamp)
            // console.log('updatetime'+updatetime)
            if (timestamp-updatetime>5) {
                if (card.find("#state_icon").attr("class")!="mini grey circle icon") {
                    myFunction({"state":false,"msg":ip+"下线"})
                    card.find("#state_icon").attr("class","mini grey circle icon")
                    var b = card.find(".bar")
                    b.first().attr("style","transition-duration: 2000ms; width:0%;")
                    b.last().attr("style","transition-duration: 2000ms; width:0%;")
                    card.find(".label#l1").text("cpu ")
                    card.find(".label#l2").text("mem ")
                }
                else {

                }
            }
            else {
                if (card.find("#state_icon").attr("class")!="mini green circle icon") {
                    myFunction({"state":true,"msg":ip+"上线"})
                    card.find("#state_icon").attr("class","mini green circle icon")
                    
                }
                else {
                    
                }
                var b = card.find(".bar")
                b.first().attr("style","transition-duration: 2000ms; width:"+cpu+"%")
                card.find(".label#l1").text("cpu "+cpu+"%")
                b.last().attr("style","transition-duration: 2000ms; width:"+mem["percent"]+"%")
                card.find(".label#l2").text("mem "+mem["percent"]+"%")
            }
            
        }
        else {
            console.log('add card')
            var t='<div class="card" id="'+id+'" onclick="serverinfo(\''+ip+'\')">\
                    <div class="content">\
                        <div data-tooltip="'+platform+'" data-position="top right" id="platform">\
                      <img class="right floated mini ui image" \
                      src={{url_for("static",filename="images/centos.png")}}>\
                        </div>\
                      <div class="header" id="ip">\
                          '+ip+'\
                          <i class="mini green circle icon" id="state_icon"></i>\
                      </div>\
                      <div class="meta">\
                          <a class="ui teal label">dev</a>\
                      </div>\
                      <div class="description">\
                          a place to development\
                      </div>\
                    </div>\
                    <div class="extra content">\
                            <div class="label" id="l1">cpu</div>\
                            <div class="ui teal progress" \
                            style="margin:0 0 0 0;" \
                            data-position="top left" \
                            id="p1">\
                            <div class="bar" \
                            style="transition-duration: 2000ms; width: '+cpu+'%;"></div>\
                            </div>\
                            <div class="label" id="l2">mem</div>\
                            <div class="ui progress" \
                            style="margin:0 0 0 0;" \
                            data-tooltip="'+mem["used"]+'/'+mem["total"]+'" \
                            data-position="bottom left" \
                            id="p2">\
                            <div class="bar"  \
                            style="transition-duration: 2000ms; width: '+mem["percent"]+'%;"></div>\
                            </div>\
                    </div>\
            </div>'
            $("#cards").append(t)
        }
    }
}
function refun() {
    $.getJSON( "api", function( data ) {
        update_form(data);
        });
}
window.setInterval( refun, 1000);
$("#ccc").find("#p2").find(".bar").attr("style","transition-duration: 3000ms; width: 37%;");
});
    </script>
    <!-- <button onclick="myFunction(new Date().getTime())">Show Snackbar</button> -->

    <!-- <div id="snackbars">Some text some message..</div> -->
    <div id="snackbars"></div>
    
    <script>
    function myFunction(data) {
        // data {'state':true,'msg':'127.0.0.1上线'}
      var x = $("#snackbars");
      var sb = $("<div></div>")
      if (data['state']) {
            sb.attr({"id":"snackbar",
                        "class":"show",
                        "style":"background-color: #00b5ad;"})
                // background-color: #00b5ad #888;
      }
      else {
        sb.attr({"id":"snackbar",
                    "class":"show",
                    "style":"background-color: #888;"})
            // background-color: #00b5ad #888;
      }
    sb.text(data["msg"])
    x.append(sb)
    //   x.className = "show";
      setTimeout(function(){ sb.remove(); }, 3000);
    }
    </script>
<!-- 服务器详情页 -->
<div class="ui modal" style="max-width: 40rem;">
        
        <i class="orange close icon" style="position: absolute; top: 1rem; right: 1rem;"></i>
        <div class="header">
          127.0.0.1
        </div>
        <div class="ui top attached tabular menu">
                <a class="item active" data-tab="first">CPU</a>
                <a class="item" data-tab="second">MEM</a>
                <a class="item" data-tab="third">DISK</a>
                <a class="item" data-tab="fourth">OPERATION</a>
              </div>
              <div class="ui bottom attached tab segment active" style="min-height: 20rem;" data-tab="first">
                CPU
                
              </div>
              <div class="ui bottom attached tab segment" style="min-height: 20rem" data-tab="second">
                MEM
              </div>
              <div class="ui bottom attached tab segment" style="min-height: 20rem" data-tab="third">
                DISK
              </div>
              <div class="ui bottom attached tab segment" style="min-height: 20rem" data-tab="fourth">                
                <div class="ui form">
                    <div class="field">
                        <label>Label</label>
                        <input type="text" name="first-name" placeholder="a lebel of server">
                    </div>
                    <div class="field">
                        <label>Server description</label>
                        <textarea rows="2"  placeholder="server description"></textarea>
                    </div>
                    <div class="ui container">
                    <button class="ui primary basic button">commit</button>
                    <button class="ui right floated negative basic button">delete server data</button>
                    </div>
                </div>
            </div></br>
      </div>
      <script>
          $('.menu .item').tab()
          function serverinfo(id) {
            $.get('/api/history/<'+id+'>',function(data){
                  $("div[data-tab='first']").text(data)
                  $("div[data-tab='second']").text(data)
                $("div[data-tab='third']").text(data)
            });
            $('.ui.modal').find(".header").text(ip)
            $('.ui.modal')
            .modal({
                dimmerSettings: { opacity: 0.3 }
                }).modal('show');
          }
      </script>
      <button onclick="serverinfo('127.0.0.1')">Show serverinfo</button>
</body>
</html>